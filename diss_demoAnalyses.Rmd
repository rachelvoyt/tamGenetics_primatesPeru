---
title: "primatesPeru_demoAnalyses"
author: "Rachel Voyt"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lubridate)
```

# Load data

## Metadata for tamRun3

```{r}
# full metadata
md_tamRun3 <- read.csv("/home/rachelvoyt/Documents/UT-Grad/Development/repos/tamGenetics_primatesPeru/03_tamRun3/03_run3GTscore/tamRun3_metadata_12Jan2022.csv") %>%
  mutate(sampleID = gsub("_","\\.", sampleID))

# animalID + sample name
animalID_sampleID <- md_tamRun3 %>%
  filter(sampleType == "hair") %>%
  select(c(animalID, sampleID))
```


## Capture log 2009-2021

First we need to combine the 2009-2019 tamarin capture log with the 2021 capture log, which gives us 700 total entries. We can then add the sampleID from tamRun3 to each capture log entry.

```{r}
capLog_2019 <- read.csv("AllCaptures_2019_rvCopy.csv") %>%
  select(c(animalID, name, species, group, captureDate, captureYear, sex, ageClass, brStatus)) %>%
  mutate(groupID = NA) %>%
  mutate(captureDate = mdy(captureDate))

capLog_2021 <- read.csv("2021_captureLog_updated.csv") %>%
  filter(Project == "PRIMATES") %>%
  select(c(AnimalID, AnimalName, Species, GroupName, GroupID, CaptureDate, Sex, Age_class)) %>%
  rename(animalID = AnimalID,
         name = AnimalName,
         species = Species,
         group = GroupName,
         groupID = GroupID,
         captureDate = CaptureDate,
         sex = Sex,
         ageClass = Age_class) %>%
  mutate(brStatus = NA) %>%
  mutate(captureDate = substr(captureDate,1,nchar(captureDate)-9)) %>%
  mutate(captureDate = ymd(captureDate)) %>%
  mutate(captureYear = year(captureDate)) %>%
  relocate(captureYear, .after = captureDate)

capLog_full <- rbind(capLog_2019, capLog_2021)
```

Then we can attach the hair genotype rates to each value in the capture log

```{r}
hair_genoRates <- read.csv("./03_tamRun3/03_run3GTscore/summaryFiles/master_sampleSummary.csv") %>%
  mutate(sampleID = gsub("-", "\\.", sampleID)) %>%
  filter(sampleType == "hair") %>%
  select(c(animalID, GenotypeRate, sampleID))

capLog_genoRates <- merge(capLog_full, hair_genoRates, by = "animalID", all.x = T)

capLog_lwed <- capLog_genoRates %>%
  filter(species == "SFUS")

capLog_simp <- capLog_genoRates %>%
  filter(species == "SIMP")
```



What groups do we have?
17 LWED groups
10 SIMP groups

```{r}
# LWED
unique(capLog_lwed$group)
length(unique(capLog_lwed$group))

# SIMP
unique(capLog_simp$group)
length(unique(capLog_simp$group))
```

# Prep files for Cervus

For parentage analyses, I'm starting off by doing analyses year by year. As such, input files for Cervus will be created as follows:
* offspring: includes all individuals of age class "Juvenile" for that year
* candidate dams/sires: includes all individuals of age class "Adult" for that year as well as individuals of age class "Sub-adult" from the previous year

## LWED 2019

Offspring = 11
Candidate dams = 17
Candidate sires = 32


```{r}
offspring_2019 <- capLog_lwed %>%
  filter(captureYear == "2019") %>%
  filter(ageClass == "Juvenile") %>%
  select(c(animalID, sampleID))

dams_2019 <- capLog_lwed %>%
  filter(captureYear %in% c(2018, 2019)) %>%
  filter(sex == "F") %>%
  filter(ageClass %in% c(NA, "Adult", "Sub-adult")) %>%
  filter(is.na(ageClass) | !(ageClass == "Sub-adult" & as.character(captureYear) == '2019')) %>%
  select(c(animalID, sampleID)) %>%
  unique()

sires_2019 <- capLog_lwed %>%
  filter(captureYear %in% c(2018, 2019)) %>%
  filter(sex == "M") %>%
  filter(ageClass %in% c(NA, "Adult", "Sub-adult")) %>%
  filter(is.na(ageClass) | !(ageClass == "Sub-adult" & as.character(captureYear) == '2019')) %>%
  select(c(animalID, sampleID)) %>%
  unique()
```



